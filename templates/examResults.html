{% extends "structure.html" %}

<!DOCTYPE html>
<html lang="en", dir="ltr">
    <head>
        <meta charset="utf-8">
        <link rel="shortcut icon" href="#">
        <title>
        </title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <body>
        <div id="LoggedInHeadding">
            <!-- find a way to get value from session and display it in html -->
        <p>{{ message }}</p>   
        <a href="/logout">Logout</a>
    </div>
        <h1>Exam test results</h1>
        <div id="svg">
        </div>
        <script>
            width=800
            height=800
            data=[
                {"hours studied":5, "test score":80, "grade":9},
                {"hours studied":6, "test score":70, "grade":10},
                {"hours studied":4, "test score":55, "grade":12},
                {"hours studied":1, "test score":20, "grade":12},
                {"hours studied":8, "test score":92, "grade":9},
                {"hours studied":10, "test score":73, "grade":10},
                {"hours studied":6, "test score":45, "grade":11},
                {"hours studied":9, "test score":60, "grade":11},
                {"hours studied":4, "test score":32, "grade":9},
                {"hours studied":7, "test score":91, "grade":9}
            ]


           svg = d3.select("#svg")
                    .append("svg")
                    .attr("height", "60%")
                    .style("max-width", width)
                    .style("max-height", height)
                    .attr("width", "60%")
                    .attr("viewBox", "0 0 800 800")
                    .attr("preserveAspectRatio", "xMinyMin")
                    .style("background-color", "#EBFFC8")

            colorScale= d3.scaleOrdinal().domain([9, 12]).range(["#FF4D27", "#FFC300", "#C70039 ", "#581845"])
            xScale=d3.scaleLinear().domain([0, 10]).range([100, 700])
            xAxis=d3.axisBottom()
                .scale(xScale)
                //.tickValues([0, 2, 4, 6, 8, 10])
            svg.append("g")
                .attr("transform", "translate(0, 700)")
                .style("font-size", "1.5pc")
                .call(xAxis)
            xLabel=svg.append("text")
                .attr("transform", "translate(400, 775)")
                .text("Hours studied")
                .style("font-size", "2pc")
                .style("font-weight", "bold")
                .attr("text-anchor", "middle")
            

            yScale=d3.scaleLinear().domain([0, 100]).range([700, 100])
            yAxis=d3.axisLeft()
                .scale(yScale)
                .tickValues([0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
            svg.append("g")
                .attr("transform", "translate(100,0)")
                .style("font-size", "1.5pc")
                .call(yAxis)
            yLabel=svg.append("text")
                .attr("transform", "translate(50, 400)rotate(270)")
                .text("Test score")
                .style("font-size", "2pc")
                .style("font-weight", "bold")
                .attr("text-anchor", "middle")
            
            title=svg.append("text")
                .attr("transform", "translate(400, 50)")
                .text("Student test results based on hours studied")
                .style("font-size", "2pc")
                .style("font-weight", "bold")
                .attr("text-anchor", "middle")


            toolTip = svg.append("text")
            var circles = svg.selectAll("circle")
                        .data(data)
                        .enter()
                        .append("circle")
                        .attr("cx",function(d){
                            return xScale(d["hours studied"])
                        })
                        .attr("cy",function(d){
                            return yScale(d["test score"])
                        })
                        .attr("r", 10)
                        .style("fill", function(d){
                            return colorScale(d["grade"])
                        })
                        .on("click", function(d){
                            svg.selectAll("circle")
                            .style("r", 10)
                            .style("opacity", 0.4)
                            d3.select(this)
                            .style("r", 14)
                            .style("opacity", 1)

                            x = d3.mouse(this)[0]
                            y = d3.mouse(this)[1]
                            //append score toolTip
                            toolTip.attr("x", x)
                                   .attr("y", y-40)
                                   .style("background-color", "#FFFFFF")
                                   .text("Score: "+d["test score"])
                                   .style("font-size", "30px")
                                   .attr("text-anchor", "middle")
                            // append grade toolTip
                            toolTip.attr("x", x)
                                   .attr("y", y-20)
                                   .style("background-color", "#FFFFFF")
                                   .text("Grade: "+d["grade"])
                                   .style("font-size", "20px")
                                   .attr("text-anchor", "middle")

                                   
                        })

        </script>
    </body>
</html>